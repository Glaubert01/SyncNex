<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SyncNex - CSN</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/png" href="assets/syncnex-favicon.png">
  <style>
    /* ===== ORG CHART (estilo da 1¬™ imagem) ===== */
    .org-wrapper{overflow-x:auto;padding:12px}
    .org-root{display:flex;flex-direction:column;align-items:center;gap:24px}
    .org-level{display:flex;gap:28px;justify-content:center;flex-wrap:nowrap}
    .org-card{
      min-width:180px; max-width:260px; text-align:center;
      background:var(--card-bg, #e7f2fb); color:var(--card-fg, #0b3a5b);
      border-radius:12px; padding:10px 12px; font-weight:700;
      box-shadow:0 1px 0 rgba(0,0,0,.08), 0 6px 14px rgba(0,0,0,.06);
    }
    .org-subcard{
      background:#fff; color:#2b2b2b; border-radius:10px; padding:8px 10px;
      font-weight:600; box-shadow:0 1px 0 rgba(0,0,0,.06);
    }
    .org-activity{font-weight:500; margin-top:6px; padding:6px 8px; border-radius:8px; background:#f6f7fb}
    .org-activity[contenteditable="true"]{outline:2px dashed #88a; background:#eef3ff}
    .org-controls{display:flex; gap:8px; justify-content:center; margin-top:8px}
    .org-controls button{font-size:12px; padding:4px 6px; border-radius:8px}

    /* Conectores (linhas) */
    .connector-v{width:2px; background:#9cb3c6; height:16px; margin:0 auto}
    .connector-h{height:2px; background:#9cb3c6; width:100%}
    .branch{display:flex; flex-direction:column; align-items:center}
    .children{position:relative; display:flex; gap:22px; margin-top:12px}
    .children:before{content:""; position:absolute; top:-12px; left:0; right:0; height:2px; background:#9cb3c6}
    .child{display:flex; flex-direction:column; align-items:center}
    .child .connector-v{height:12px}

    /* Dark mode ajuste para cart√µes */
    body.dark-mode .org-card{--card-bg:#124c74; --card-fg:#e6f0f7}
    body.dark-mode .org-subcard{background:#1e2b36; color:#e6f0f7}
    body.dark-mode .org-activity{background:#16222c; color:#cfe2f3}
    body.dark-mode .connector-v, body.dark-mode .children:before{background:#3a5366}

    /* Cabe√ßalhos ‚Äúpessoa / pilar‚Äù */
    .label-muted{font-size:11px; font-weight:600; opacity:.8; letter-spacing:.04em}
    .pill-title{font-size:13px}
    .editable[contenteditable="true"]{outline:2px dashed #88a; border-radius:6px; padding:2px 4px}
    .xbtn{margin-left:6px; cursor:pointer}
  </style>
</head>
<body>
  <button id="toggle-mode" class="darkmode-btn" title="Alternar modo escuro">üåì</button>
  <button class="menu-toggle" id="menu-toggle" aria-label="Abrir menu">&#9776;</button>

  <div class="container">
    <aside class="sidebar" id="sidebar">
      <a href="index.html">
        <img src="assets/logo-csn.png" alt="Logo CSN" class="logo-csn" />
      </a>
      <ul class="menu">
        <li><a href="absenteismo.html">Absenteismo</a></li>
        <li><a href="contratos.html">Contratos</a></li>
        <li><a href="dgfm.html">DGFM</a></li>
        <li><a href="diesel.html">Diesel</a></li>
        <li><a href="efetivo.html">Efetivo</a></li>
        <li><a href="horaextra.html">Horas Extras</a></li>
        <li><a href="kanban.html">Kanban</a></li>
        <li><a href="mapa.html">Mapa</a></li>
        <li class="menu__item"><a href="milk.html">Milk Run</a></li>
        <li><a href="mttr.html">MTTR</a></li>
        <li><a href="mtbf.html">MTBF</a></li>
        <li class="menu__item"><a href="organograma.html">Organograma</a></li>
        <li><a href="projetos.html">Projetos</a></li>
        <li><a href="sobressalentes.html">Sobressalentes</a></li>
      </ul>
    </aside>

    <main class="main-content">
      <h2 class="titulo">Organograma de Atividades Staffs GIL</h2>

      <!-- Onde o organograma hier√°rquico √© renderizado -->
      <div id="organograma" class="org-wrapper"></div>

      <div class="controls">
        <button id="edit-mode-btn" onclick="toggleEditMode()">Editar</button>
        <button onclick="addPessoa()">Adicionar Pessoa</button>
        <button onclick="addPilar()">Adicionar Pilar</button>
        <button onclick="salvar()">Salvar</button>
      </div>
    </main>
  </div>

  <script>
    let editMode = false;

    // Estado principal (mesmo formato, aproveitando seu localStorage)
    let data = JSON.parse(localStorage.getItem("organograma")) || {
      pessoas: ["Glaubert", "Sergio", "Daiana"],
      pilares: ["Pilar A", "Pilar B", "Pilar C"],
      atividades: [
        ["Atividade A1", "Atividade A2", "Atividade A3"],
        ["Atividade B1", "Atividade B2", "Atividade B3"],
        ["Atividade C1", "Atividade C2", "Atividade C3"]
      ]
    };

    // ---- Render em √ÅRVORE: Equipe (raiz) -> Pessoas -> Pilares c/ atividades da pessoa ----
    function renderChart() {
      const wrap = document.getElementById("organograma");
      wrap.innerHTML = "";

      // N√≠vel Raiz
      const root = document.createElement("div");
      root.className = "org-root";

      const topo = document.createElement("div");
      topo.className = "org-card";
      topo.innerHTML = `<div class="label-muted">EQUIPE</div>
                        <div>Staffs GIL</div>`;
      root.appendChild(topo);
      root.appendChild(connectorV());

      // N√≠vel Pessoas
      const pessoasLevel = document.createElement("div");
      pessoasLevel.className = "org-level";

      data.pessoas.forEach((nome, idxPessoa) => {
        const branch = document.createElement("div");
        branch.className = "branch";

        const pessoaCard = document.createElement("div");
        pessoaCard.className = "org-card";
        pessoaCard.innerHTML = `
          <div class="label-muted">PESSOA</div>
          <div class="editable" contenteditable="${editMode}"
               oninput="updateNome(${idxPessoa}, this.innerText)">${nome}</div>
          ${editMode ? `<span class="xbtn" title="Remover" onclick="removerPessoa(${idxPessoa})">‚ùå</span>` : ""}
        `;
        branch.appendChild(pessoaCard);

        // Conector vertical da pessoa para os pilares
        branch.appendChild(connectorV());

        // Filhos (pilares que possuem atividade para essa pessoa)
        const children = document.createElement("div");
        children.className = "children";

        // Para cada pilar (linha i) verificar se existe texto em atividades[i][idxPessoa]
        data.pilares.forEach((pilarNome, i) => {
          const atividade = (data.atividades[i] || [])[idxPessoa] || "";

          // Mostra o pilar apenas se houver texto (ou se estiver em modo de edi√ß√£o)
          if (atividade.trim() !== "" || editMode) {
            const child = document.createElement("div");
            child.className = "child";

            const pilarCard = document.createElement("div");
            pilarCard.className = "org-subcard";
            pilarCard.innerHTML = `
              <div class="label-muted">PILAR</div>
              <div class="pill-title editable" contenteditable="${editMode}"
                   oninput="updatePilar(${i}, this.innerText)">${pilarNome}</div>
              ${editMode ? `<span class="xbtn" title="Remover Pilar" onclick="removerPilar(${i})">üóëÔ∏è</span>` : ""}
              <div class="org-activity editable" contenteditable="${editMode}"
                   oninput="updateAtividade(${i}, ${idxPessoa}, this.innerText)">${atividade}</div>
              ${editMode ? `<div class="org-controls">
                              <button onclick="limparAtividade(${i}, ${idxPessoa})">Limpar</button>
                            </div>` : ""}
            `;
            child.appendChild(pilarCard);
            children.appendChild(child);
          }
        });

        // Linha horizontal s√≥ aparece se houver ao menos um ‚Äúchild‚Äù
        if (children.children.length > 0) {
          branch.appendChild(children);
        } else {
          // Sem filhos vis√≠veis: remove o conector extra
          branch.removeChild(branch.lastChild);
        }

        pessoasLevel.appendChild(branch);
      });

      root.appendChild(pessoasLevel);
      wrap.appendChild(root);
    }

    function connectorV(){
      const v = document.createElement("div");
      v.className = "connector-v";
      return v;
    }

    // ------- Atualiza√ß√µes de estado -------
    function toggleEditMode() {
      editMode = !editMode;
      const btn = document.getElementById("edit-mode-btn");
      btn.textContent = editMode ? "Concluir edi√ß√£o" : "Editar";
      renderChart();
      if (!editMode) salvar();
    }

    function updateNome(index, valor){ data.pessoas[index] = valor.trim(); }
    function updatePilar(index, valor){ data.pilares[index] = valor.trim(); }
    function updateAtividade(i, j, valor){
      if (!data.atividades[i]) data.atividades[i] = [];
      data.atividades[i][j] = valor;
    }

    function addPessoa(){
      const nome = prompt("Nome da nova pessoa:");
      if (!nome) return;
      data.pessoas.push(nome);
      data.atividades.forEach(r => r.push(""));
      renderChart();
    }

    function addPilar(){
      const nome = prompt("Nome do novo pilar:");
      if (!nome) return;
      data.pilares.push(nome);
      const nova = data.pessoas.map(()=>"");
      data.atividades.push(nova);
      renderChart();
    }

    function removerPessoa(index){
      if (!confirm("Remover esta pessoa e suas atividades?")) return;
      data.pessoas.splice(index,1);
      data.atividades.forEach(r=>r.splice(index,1));
      renderChart();
    }

    function removerPilar(index){
      if (!confirm("Remover este pilar (todas as atividades nas pessoas)?")) return;
      data.pilares.splice(index,1);
      data.atividades.splice(index,1);
      renderChart();
    }

    function limparAtividade(i,j){
      if (!data.atividades[i]) return;
      data.atividades[i][j] = "";
      renderChart();
    }

    function salvar(){
      localStorage.setItem("organograma", JSON.stringify(data));
      alert("Salvo com sucesso!");
    }

    // ---- DARK MODE persistente + menu lateral ----
    document.addEventListener("DOMContentLoaded", () => {
      if (localStorage.getItem("dark-mode") === "1") {
        document.body.classList.add("dark-mode");
      }
      const toggleButton = document.getElementById("toggle-mode");
      if (toggleButton) {
        toggleButton.addEventListener("click", () => {
          document.body.classList.toggle("dark-mode");
          localStorage.setItem("dark-mode", document.body.classList.contains("dark-mode") ? "1" : "");
        });
      }
      renderChart();
    });

    const menuToggle = document.getElementById('menu-toggle');
    const sidebar = document.getElementById('sidebar');
    menuToggle.addEventListener('click', function () {
      sidebar.classList.toggle('active');
    });
    document.addEventListener('click', function (e) {
      if (window.innerWidth <= 768 && sidebar.classList.contains('active') &&
          !sidebar.contains(e.target) && !menuToggle.contains(e.target)) {
        sidebar.classList.remove('active');
      }
    });
  </script>

  <footer class="footer">
    <div class="footer-content" style="display:flex; justify-content:space-between; align-items:center;">
      <div class="footer-logo-group">
        <img src="assets/syncnex-logo-64x64.png" alt="Logo SyncNex" class="footer-logo" />
        <div>
          <span class="footer-title">SyncNex &copy; 2025</span>
          <span class="footer-slogan">Conectando efici√™ncia ao seu neg√≥cio</span>
        </div>
      </div>
      <nav class="footer-nav">
        <a href="#">Sobre N√≥s</a>
        <a href="#">Contato</a>
        <a href="#">Pol√≠tica de Privacidade</a>
        <a href="#">Termos de Uso</a>
      </nav>
      <span class="versao">Vers√£o <b>V1.0.0</b></span>
    </div>
  </footer>
</body>
</html>
